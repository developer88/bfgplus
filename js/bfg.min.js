(function(){var c,b,a,d=function(e,f){return function(){return e.apply(f,arguments)}};b=(function(){function e(f){this.data=f;this.options=this.data.options;this.id=this.data.id;this.attachments=this.data.object!==void 0&&this.data.object["attachments"]!==void 0?this.data.object["attachments"]:[];this.type=this.determine_type();this.preview=this.determine_preview_background();this.title=this.determine_title();this.annotation=this.determine_annotation();this.album_content=this.determine_album_content();this.content=this.determine_content()}e.prototype.determine_album_content=function(){var g,k,j,i,f,h;if(!(this.attachments.length>0&&this.attachments[0]["thumbnails"]!==void 0&&this.attachments[0]["thumbnails"].length>0)){return""}j="<ul class='thumbnails'>";g=0;h=this.attachments[0]["thumbnails"];for(i=0,f=h.length;i<f;i++){k=h[i];j+="<li class='"+(g===0?"span4":"span2")+"' data-number='"+(g+=1)+"'><a href='"+k.url+"' class='thumbnail'><img alt='' src='"+k.image["url"]+"'/></a></li>"}return j+="</ul>"};e.prototype.determine_annotation=function(){var f,i,h,j,g;if(this.data.annotation){return this.data.annotation}if(!this.data.title){return""}if(this.title!==void 0){if(this.title.length<=parseInt(this.options.annotation_length)){return this.title}f=this.title.split(/\s/);h="";for(j=0,g=f.length;j<g;j++){i=f[j];if(h.length<this.options.annotation_length){h+=(h.length===0?"":" ")+i}}return h+"..."}};e.prototype.determine_content=function(){var f,g;f="";if(this.data.title){f=this.data.title}if(this.data.content){f+="<div>"+this.data.content+"</div>"}g="<div class='bfg-post-read-more'><i class='icon-arrow-right'></i><a href='"+(this.attachments.length===0?this.data.object["url"]:this.attachments[0]["url"])+"' target='_blank'>"+$.t("read_more")+"</a></div>";f+=g;if(this.attachments.length>0){switch(this.type){case"photo":f+="<div class='bfg-photo-content'><img src='"+this.attachments[0]["image"]["url"]+"' /></div>";break;case"article":f+="<div class='bfg-article-content well well-large'>"+this.data.object["attachments"][0]["content"]+(this.attachments[0]["fullImage"]!==void 0?"<img src='"+this.attachments[0]["fullImage"]["url"]+"' class='img-polaroid'/>":"")+"</div>";break;case"video":f+="<div class='bfg-video-content'><div class='video-caption'>"+this.attachments[0]["displayName"]+"</div>"+(this.attachments[0]["embed"]!==void 0?"<embed src='"+this.attachments[0]["embed"]["url"]+"' type='"+this.attachments[0]["embed"]["type"]+"'>":"<img src='"+this.attachments[0]["image"]["url"]+"' />")+"</div>";break;case"album":f+="<div class='bfg-album-content'>"+(this.album_content.length!==void 0?this.album_content:void 0)+"</div>"}}return f};e.prototype.modal=function(){var f;f="<div id='bfg-post-"+this.id+"-modal' class='modal hide fade' tabindex='-1' role='dialog' aria-labelledby='BfgPostLabel-"+this.id+"' aria-hidden='true'>";f+="<div class='modal-header'>";f+="<a href='#' class='close' data-dismiss='modal' aria-hidden='true'><i class='icon-remove'></i></a>";f+="<h3 id='BfgPostLabel-"+this.id+"'>"+this.title+"</h3>";f+="</div>";f+="<div class='modal-body'><div class='bfg-post-type'>"+this.type+"</div><div class='bfg-post-main-container'>"+this.content+"</div></div>";f+="<div class='modal-footer'>";f+="<button class='btn close_button' data-dismiss='modal' aria-hidden='true'>"+$.t("close")+"</button>";return f+="</div></div>"};e.prototype.html=function(){var f;f="<div id='bfg-post-"+this.id+"' class='thumbnail bfg-post bfg-post-background-"+this.type+"' data-id='"+this.id+"' data-image='"+this.preview+"'>";f+="<span class='bfg-post-header'>"+this.annotation+"</span>";return f+="</div>"};e.prototype.render_to=function(f){$(f).append(this.html());$("body").append(this.modal());return this.place_callbacks()};e.prototype.place_callbacks=function(){var f,h,g,i=this;h="#bfg-post-"+this.id+"-modal";g="#bfg-post-"+this.id;f="#bfg-post-"+this.id+"-carousel";$(g).click(function(){return $(h).modal("show")});if(this.preview){$(g).css("background-image","url("+this.preview+")");$(g).css("background-position","40% 40%");return $(g).css("background-size","250%")}};e.prototype.determine_title=function(){if(this.data.title.length>0){return this.data.title}else{return $.t("type."+this.type)}};e.prototype.determine_preview_background=function(){if(this.attachments.length>0){switch(this.type){case"post":return this.attachments[0]["image"]["url"];case"photo":return this.attachments[0]["image"]["url"];case"video":return this.attachments[0]["image"]["url"];case"album":return this.attachments[0]["thumbnails"][0]["image"]["url"];case"article":return"";case"event":return"";default:return""}}else{return""}};e.prototype.determine_type=function(){if(this.attachments.length>0){return this.attachments[0]["objectType"]}else{return"note"}};return e})();c=(function(){e.prototype.languages=function(){var g,h,f;g={translation:{read_more:"Read more",close:"Close",type:{video:"Video",post:"Post",photo:"Photo",album:"Album",article:"Article",event:"Event"}}};f={translation:{read_more:"Подробнее",close:"Закрыть",type:{video:"Видео",post:"Заметка",photo:"Фото",album:"Альбом",article:"Статья",event:"Событие"}}};return h={dev:g,en:g,"en-US":g,"ru-RU":f,ru:f}};function e(f){var h,g,i;this.options=f;this.load_blog_callback=d(this.load_blog_callback,this);this.options||(this.options=[]);(g=this.options)["locale"]||(g.locale="en-US");(i=this.options)["count"]||(i.count=100);this.options.annotation_length=35;this.processed_posts=[];this.posts=[];if(!this.options.api||!this.options.user||!this.options.dom){throw"Cannot load BFG+ because of wrong initial params"}h={resStore:this.languages(),lng:this.options.locale,debug:false};$.i18n.init(h)}e.prototype.initialize=function(){$(this.options.dom).html("");this.place_and_show_progress_bar();return this.load_blog()};e.prototype.load_blog=function(){return $.getJSON("https://www.googleapis.com/plus/v1/people/"+this.options.user+"/activities/public?maxResults="+this.options.count+"&key="+this.options.api,this.load_blog_callback)};e.prototype.load_blog_callback=function(j){var g,i,f,h;this.posts=j.items;if(this.posts.length>0){this.hide_div_and_prepare_container();h=this.posts;for(i=0,f=h.length;i<f;i++){g=h[i];if(g.provider["title"]!=="Google Check-ins"){this.process_post(g)}}}return true};e.prototype.blog_posts=function(){return this.posts};e.prototype.process_post=function(f){var g;if(!f){return false}f.options=this.options;g=new b(f);return g.render_to(this.options.dom)};e.prototype.place_and_show_progress_bar=function(){return $(this.options.dom).html('<div class="bfg-margin-auto"><div class="progress progress-striped active"><div class="bar" style="width: 20%;"></div></div></div>')};e.prototype.hide_div_and_prepare_container=function(){$(this.options.dom).html("");return $(this.options.dom).addClass("bfg-body")};e.prototype.d=function(f){return console.log(f)};return e})();a=typeof exports!=="undefined"&&exports!==null?exports:this;a.Bfg=c}).call(this);